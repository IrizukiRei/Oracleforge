<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OracleForge - Card Shuffler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Hiragino Mincho ProN', 'Yu Mincho', 'YuMincho', serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #fff;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 15px;
            padding-bottom: 80px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-shadow: 0 0 10px rgba(100,200,255,0.5);
            letter-spacing: 0.2em;
            font-weight: 300;
        }
        
        @media (min-width: 768px) {
            h1 {
                font-size: 2.2em;
                letter-spacing: 0.3em;
            }
        }
        
        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .nav-tabs button {
            padding: 10px 12px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            color: #fff;
            cursor: pointer;
            border-radius: 8px;
            font-size: 12px;
            transition: all 0.3s;
            flex: 1;
            min-width: 60px;
            max-width: 120px;
        }
        
        @media (min-width: 768px) {
            .nav-tabs button {
                padding: 12px 24px;
                font-size: 16px;
                max-width: none;
            }
        }
        
        .nav-tabs button:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .nav-tabs button.active {
            background: rgba(100,200,255,0.3);
            border-color: rgba(100,200,255,0.8);
        }
        
        .screen {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .card-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
        }
        
        .card-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .card-preview {
            width: 100%;
            aspect-ratio: 2/3;
            background: #2a2a4a;
            border-radius: 4px;
            margin-bottom: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #888;
        }
        
        .card-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .card-item input[type="text"],
        .card-item textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 14px;
        }
        
        .card-item textarea {
            resize: vertical;
            min-height: 50px;
        }
        
        .upload-btn {
            width: 100%;
            padding: 10px;
            background: rgba(100,200,255,0.2);
            border: 1px solid rgba(100,200,255,0.5);
            color: #fff;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 5px;
            font-size: 14px;
        }
        
        .upload-btn:active {
            background: rgba(100,200,255,0.4);
        }
        
        /* ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰é¸æŠ */
        .spread-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        
        @media (min-width: 768px) {
            .spread-selection {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
        }
        
        .spread-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .spread-card:active {
            background: rgba(255,255,255,0.2);
            border-color: rgba(100,200,255,0.8);
        }
        
        .spread-card h3 {
            margin-bottom: 8px;
            color: #64c8ff;
            font-size: 1em;
        }
        
        .spread-card p {
            font-size: 12px;
            line-height: 1.4;
        }
        
        /* ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .spread-display {
            position: relative;
            min-height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            background: rgba(0,0,0,0.3);
            border: 3px solid rgba(100,200,255,0.5);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(100,200,255,0.3);
            overflow-x: auto;
        }
        
        .spread-inner {
            position: relative;
            min-width: 550px;
            min-height: 300px;
        }
        
        .card-slot {
            width: 70px;
            height: 105px;
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 6px;
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            perspective: 1000px;
            transform: translate(-50%, -50%);
        }
        
        @media (min-width: 768px) {
            .card-slot {
                width: 100px;
                height: 150px;
                font-size: 12px;
            }
            
            .spread-inner {
                min-width: 700px;
                min-height: 450px;
            }
        }
        
        .card-slot.filled {
            border: 2px solid rgba(100,200,255,0.8);
            background: transparent;
        }
        
        /* ãƒœã‚¿ãƒ³ */
        .controls {
            text-align: center;
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 20px;
            background: rgba(100,200,255,0.2);
            border: 2px solid rgba(100,200,255,0.5);
            color: #fff;
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            letter-spacing: 0.1em;
        }
        
        .btn:active {
            background: rgba(100,200,255,0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* æƒ…å ±ãƒœãƒƒã‚¯ã‚¹ */
        .deck-info {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 14px;
        }
        
        .error-message {
            background: rgba(220,53,69,0.3);
            border: 2px solid #dc3545;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-size: 14px;
        }
        
        .card-number {
            font-size: 10px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .add-cards-section {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .add-cards-section input {
            padding: 10px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3);
            color: #fff;
            width: 80px;
        }

        .back-card-section {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .back-preview {
            width: 60px;
            height: 90px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #fff;
            flex-shrink: 0;
        }

        .back-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .result-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .result-info h3 {
            color: #64c8ff;
            margin-bottom: 12px;
            font-size: 1em;
        }

        .card-meaning {
            margin: 8px 0;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
            font-size: 14px;
        }

        .card-meaning strong {
            color: #64c8ff;
        }

        .info-box {
            background: rgba(100,200,255,0.1);
            border: 2px solid rgba(100,200,255,0.3);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .info-box h3 {
            color: #64c8ff;
            margin-bottom: 8px;
            font-size: 1em;
        }

        /* ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .shuffle-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 120px;
            perspective: 1000px;
        }
        
        .shuffle-card {
            position: absolute;
            width: 70px;
            height: 105px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        
        .shuffle-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }
        
        @keyframes shuffleSpread {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(var(--tx), var(--ty)) rotate(var(--rot)); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        
        @keyframes shuffleRiffle {
            0%, 100% { transform: translateY(0) rotateX(0); }
            25% { transform: translateY(-30px) rotateX(-15deg); }
            75% { transform: translateY(-15px) rotateX(10deg); }
        }
        
        @keyframes cardFlyOut {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--fly-x), var(--fly-y)) scale(0.8); opacity: 0; }
        }
        
        .shuffling .shuffle-card {
            animation: shuffleRiffle 0.4s ease-in-out infinite;
            animation-delay: var(--delay);
        }
        
        .spreading .shuffle-card {
            animation: shuffleSpread 0.6s ease-out forwards;
        }

        /* ã‚«ãƒ¼ãƒ‰ãƒ•ãƒªãƒƒãƒ— */
        .card-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        
        .card-inner.flipped {
            transform: rotateY(180deg);
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .card-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .card-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .card-front {
            transform: rotateY(180deg);
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .card-front img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .card-front.reversed img,
        .card-front.reversed .card-text {
            transform: rotate(180deg);
        }
        
        .card-text {
            padding: 5px;
            color: #333;
            font-size: 10px;
            text-align: center;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-image {
            max-width: 90%;
            max-height: 85%;
            object-fit: contain;
        }
        
        .modal-image.reversed {
            transform: rotate(180deg);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 40px;
            color: white;
            cursor: pointer;
            z-index: 10000;
        }

        /* å„€å¼ç”»é¢ */
        .ritual-container {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            max-width: 800px;
            margin: 0 auto;
        }

        .ritual-section {
            margin-bottom: 30px;
        }

        .ritual-section h3 {
            color: #64c8ff;
            margin-bottom: 12px;
            font-size: 1em;
        }

        .ritual-section p {
            line-height: 1.8;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .question-list {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .question-list li {
            list-style: none;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
        }

        .question-list li:active {
            background: rgba(100,200,255,0.2);
        }

        textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid rgba(100,200,255,0.3);
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 14px;
            min-height: 80px;
            font-family: inherit;
        }

        .crystal-item {
            background: rgba(100,200,255,0.05);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #64c8ff;
        }

        .crystal-date {
            font-size: 11px;
            color: #888;
            margin-bottom: 5px;
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        .title-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0f14 0%, #1a1f2e 50%, #0f1a20 100%);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: opacity 0.5s ease;
        }

        .title-screen.hidden {
            display: none;
        }

        /* èƒŒæ™¯ã®èœ˜è››ã®å·£ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .web-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.15;
            background-image: 
                radial-gradient(circle at 50% 50%, transparent 0%, transparent 40%, rgba(100,200,255,0.1) 41%, transparent 42%),
                radial-gradient(circle at 50% 50%, transparent 0%, transparent 60%, rgba(100,200,255,0.08) 61%, transparent 62%),
                radial-gradient(circle at 50% 50%, transparent 0%, transparent 80%, rgba(100,200,255,0.05) 81%, transparent 82%);
            background-size: 100% 100%;
            animation: webPulse 8s ease-in-out infinite;
        }

        .web-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(0deg, transparent 49.5%, rgba(100,200,255,0.1) 50%, transparent 50.5%),
                linear-gradient(60deg, transparent 49.5%, rgba(100,200,255,0.1) 50%, transparent 50.5%),
                linear-gradient(120deg, transparent 49.5%, rgba(100,200,255,0.1) 50%, transparent 50.5%);
            background-size: 100% 100%;
        }

        @keyframes webPulse {
            0%, 100% { transform: scale(1); opacity: 0.15; }
            50% { transform: scale(1.05); opacity: 0.25; }
        }

        /* æµ®éŠã™ã‚‹çµæ™¶ */
        .floating-crystal {
            position: absolute;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, rgba(100,200,255,0.6), rgba(180,100,255,0.6));
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            animation: floatCrystal 6s ease-in-out infinite;
            filter: blur(1px);
        }

        @keyframes floatCrystal {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.6; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }

        /* ãƒ¡ã‚¤ãƒ³ç¹­ã‚¢ã‚¤ã‚³ãƒ³ */
        .cocoon-icon {
            width: 120px;
            height: 160px;
            position: relative;
            margin-bottom: 30px;
            animation: cocoonFloat 4s ease-in-out infinite;
        }

        .cocoon-body {
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at 50% 30%, #fff 0%, #e8e8f0 40%, #c0c0d0 100%);
            border-radius: 50% 50% 45% 45%;
            position: relative;
            box-shadow: 
                0 0 30px rgba(100,200,255,0.3),
                0 0 60px rgba(100,200,255,0.2),
                inset 0 -20px 40px rgba(100,150,200,0.2);
        }

        .cocoon-body::before {
            content: 'ğŸŒ¿';
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
        }

        @keyframes cocoonFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ãƒ†ã‚­ã‚¹ãƒˆ */
        .title-text {
            font-size: 2.5em;
            letter-spacing: 0.4em;
            color: #fff;
            text-shadow: 
                0 0 10px rgba(100,200,255,0.8),
                0 0 20px rgba(100,200,255,0.5),
                0 0 40px rgba(100,200,255,0.3);
            margin-bottom: 10px;
            animation: titleGlow 3s ease-in-out infinite;
        }

        .title-sub {
            font-size: 1em;
            letter-spacing: 0.3em;
            color: rgba(200,220,255,0.7);
            margin-bottom: 40px;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(100,200,255,0.8), 0 0 20px rgba(100,200,255,0.5); }
            50% { text-shadow: 0 0 20px rgba(100,200,255,1), 0 0 40px rgba(100,200,255,0.8), 0 0 60px rgba(180,100,255,0.5); }
        }

        .start-btn {
            padding: 15px 50px;
            background: transparent;
            border: 2px solid rgba(100,200,255,0.5);
            color: #fff;
            font-size: 1.1em;
            letter-spacing: 0.2em;
            cursor: pointer;
            border-radius: 30px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(100,200,255,0.3), transparent);
            transition: left 0.5s;
        }

        .start-btn:hover::before {
            left: 100%;
        }

        .start-btn:hover {
            background: rgba(100,200,255,0.2);
            box-shadow: 0 0 20px rgba(100,200,255,0.5);
        }

        /* è¶ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .butterfly {
            position: absolute;
            font-size: 20px;
            opacity: 0.6;
            animation: butterflyFly 15s linear infinite;
        }

        @keyframes butterflyFly {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(100px, -50px) rotate(10deg); }
            50% { transform: translate(50px, -100px) rotate(-5deg); }
            75% { transform: translate(-50px, -30px) rotate(5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        /* ã‚»ãƒƒãƒˆç®¡ç† */
        .sets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .set-input {
            padding: 10px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3);
            color: #fff;
            width: 100%;
            max-width: 250px;
            margin-bottom: 10px;
        }

        /* ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è­¦å‘Š */
        .storage-warning {
            background: rgba(255,193,7,0.2);
            border: 2px solid #ffc107;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .storage-info {
            font-size: 12px;
            color: #888;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
    <div class="title-screen" id="titleScreen">
        <div class="web-bg"></div>
        
        <!-- æµ®éŠã™ã‚‹çµæ™¶ -->
        <div class="floating-crystal" style="top:15%;left:20%;animation-delay:0s;"></div>
        <div class="floating-crystal" style="top:25%;left:75%;animation-delay:1s;width:15px;height:15px;"></div>
        <div class="floating-crystal" style="top:60%;left:15%;animation-delay:2s;width:25px;height:25px;"></div>
        <div class="floating-crystal" style="top:70%;left:80%;animation-delay:3s;"></div>
        <div class="floating-crystal" style="top:40%;left:85%;animation-delay:1.5s;width:12px;height:12px;"></div>
        
        <!-- è¨€èªé¸æŠ -->
        <div style="position:absolute;top:20px;right:20px;">
            <select id="lang-select" onchange="changeLang(this.value)" style="padding:8px 12px;background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.4);color:#fff;border-radius:6px;font-size:14px;">
                <option value="ja" style="color:#000;">æ—¥æœ¬èª</option>
                <option value="en" style="color:#000;">English</option>
            </select>
        </div>
        
        <!-- ã‚¢ã‚¤ã‚³ãƒ³ -->
        <div style="font-size:80px;margin-bottom:20px;">ğŸƒ</div>
        
        <div class="title-text">OracleForge</div>
        <div class="title-sub">Card Shuffler</div>
        
        <button class="start-btn" id="startBtn" data-ja="ã¯ã˜ã‚ã‚‹" data-en="START" onclick="hideTitle()">ã¯ã˜ã‚ã‚‹</button>
    </div>

    <div class="container">
        <h1>OracleForge</h1>
        
        <div class="nav-tabs">
            <button onclick="goHome()" style="background:rgba(255,200,100,0.2);border-color:rgba(255,200,100,0.5);">ğŸ </button>
            <button class="active" onclick="showScreen('edit')" data-ja="ç·¨é›†" data-en="Edit">ç·¨é›†</button>
            <button onclick="showScreen('sets')" data-ja="ã‚»ãƒƒãƒˆ" data-en="Sets">ã‚»ãƒƒãƒˆ</button>
            <button onclick="showScreen('spread')" data-ja="å±•é–‹" data-en="Spread">å±•é–‹</button>
            <button onclick="showScreen('reading')" data-ja="å ã†" data-en="Read">å ã†</button>
            <button onclick="showScreen('lottery')" data-ja="ãã˜" data-en="Draw">ãã˜</button>
            <button onclick="showScreen('ritual')" data-ja="è¨˜éŒ²" data-en="Notes">è¨˜éŒ²</button>
        </div>

        <!-- ã‚«ãƒ¼ãƒ‰ç·¨é›†ç”»é¢ -->
        <div id="edit-screen" class="screen active">
            <div class="info-box">
                <h3>ğŸ“± <span data-ja="ã‚¹ãƒãƒ›å¯¾å¿œç‰ˆ" data-en="Mobile Ready">ã‚¹ãƒãƒ›å¯¾å¿œç‰ˆ</span></h3>
                <p data-ja="ç”»åƒã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«ã«æ®‹ã‚Šã¾ã™ã€‚" data-en="Images are saved in browser. Data stays on your device.">ç”»åƒã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«ã«æ®‹ã‚Šã¾ã™ã€‚</p>
            </div>

            <div class="info-box" style="background:rgba(255,200,100,0.1);border-color:rgba(255,200,100,0.3);">
                <h3>ğŸ’¾ <span data-ja="ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ" data-en="Data Transfer">ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ</span></h3>
                <p style="margin-bottom:10px;" data-ja="PCâ†”ã‚¹ãƒãƒ›é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç§»ã™ã«ã¯ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨" data-en="Use Export/Import to transfer data between PC and mobile">PCâ†”ã‚¹ãƒãƒ›é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç§»ã™ã«ã¯ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨</p>
                <div style="display:flex;gap:10px;flex-wrap:wrap;">
                    <button class="btn" onclick="exportData()" style="padding:10px 15px;font-size:13px;" data-ja="ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ" data-en="Export">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <input type="file" accept=".json" style="display:none" id="import-file" onchange="importData(this)">
                    <button class="btn" onclick="document.getElementById('import-file').click()" style="padding:10px 15px;font-size:13px;" data-ja="ã‚¤ãƒ³ãƒãƒ¼ãƒˆ" data-en="Import">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                </div>
            </div>

            <div id="storage-warning" class="storage-warning" style="display:none;" data-ja="âš ï¸ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ãŒå¤šããªã£ã¦ã„ã¾ã™ã€‚ç”»åƒã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ã‹ã€ä¸è¦ãªã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚" data-en="âš ï¸ Storage is running low. Reduce image sizes or delete unused cards.">
                âš ï¸ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ãŒå¤šããªã£ã¦ã„ã¾ã™ã€‚ç”»åƒã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ã‹ã€ä¸è¦ãªã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚
            </div>

            <div class="deck-info">
                <p><span data-ja="ã‚«ãƒ¼ãƒ‰" data-en="Cards">ã‚«ãƒ¼ãƒ‰</span>: <span id="master-count">0</span><span data-ja="æš" data-en=""> æš</span> / <span data-ja="æœ‰åŠ¹" data-en="Active">æœ‰åŠ¹</span>: <span id="active-count">0</span><span data-ja="æš" data-en=""></span></p>
                <div class="storage-info" id="storage-info"></div>
            </div>

            <div class="back-card-section">
                <div>
                    <div style="font-size:12px;margin-bottom:5px;" data-ja="è£é¢" data-en="Back">è£é¢</div>
                    <div class="back-preview" id="back-preview">ğŸ”®</div>
                </div>
                <div style="flex:1;">
                    <input type="file" accept="image/*" style="display:none" 
                           id="back-file" onchange="selectBackImage(this)">
                    <button class="btn" onclick="document.getElementById('back-file').click()" data-ja="è£é¢ç”»åƒ" data-en="Back Image">
                        è£é¢ç”»åƒ
                    </button>
                </div>
            </div>

            <div class="back-card-section">
                <div>
                    <div style="font-size:12px;margin-bottom:5px;" data-ja="ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼" data-en="Significator">ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼</div>
                    <div class="back-preview" id="sig-preview" style="background:rgba(255,200,100,0.3);" data-ja="æœªè¨­å®š" data-en="Not set">æœªè¨­å®š</div>
                </div>
                <div style="flex:1;">
                    <button class="btn" onclick="openSignificatorSelect()" style="font-size:13px;" data-ja="ã‚«ãƒ¼ãƒ‰é¸æŠ" data-en="Select Card">
                        ã‚«ãƒ¼ãƒ‰é¸æŠ
                    </button>
                    <button class="btn" onclick="clearSignificator()" style="font-size:13px;background:rgba(220,53,69,0.3);border-color:#dc3545;" data-ja="è§£é™¤" data-en="Clear">
                        è§£é™¤
                    </button>
                    <div style="font-size:11px;color:#888;margin-top:5px;" data-ja="ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã§ã€Œç§ã€ã‚’ç¤ºã™åŸºæº–æœ­" data-en="Card representing 'yourself' in spreads">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã§ã€Œç§ã€ã‚’ç¤ºã™åŸºæº–æœ­</div>
                </div>
            </div>
            
            <div class="add-cards-section">
                <label style="font-size:14px;" data-ja="æšæ•°:" data-en="Cards:">æšæ•°:</label>
                <input type="number" id="card-count-input" min="1" max="150" value="10">
                <button class="btn" onclick="setCardCount()" data-ja="è¨­å®š" data-en="Set">è¨­å®š</button>
            </div>
            
            <div id="card-grid" class="card-grid"></div>
        </div>

        <!-- ã‚»ãƒƒãƒˆç®¡ç†ç”»é¢ -->
        <div id="sets-screen" class="screen">
            <div class="info-box">
                <h3>ğŸ“¦ <span data-ja="ã‚»ãƒƒãƒˆç®¡ç†" data-en="Set Management">ã‚»ãƒƒãƒˆç®¡ç†</span></h3>
                <p data-ja="è¤‡æ•°ã®ã‚«ãƒ¼ãƒ‰ã‚»ãƒƒãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¦ä½¿ç”¨ã§ãã¾ã™" data-en="Switch between multiple card sets">è¤‡æ•°ã®ã‚«ãƒ¼ãƒ‰ã‚»ãƒƒãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¦ä½¿ç”¨ã§ãã¾ã™</p>
            </div>

            <div class="deck-info">
                <p><span data-ja="ç¾åœ¨" data-en="Current">ç¾åœ¨</span>: <strong id="current-set-name">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</strong></p>
            </div>

            <div style="margin-bottom:15px;">
                <input type="text" id="new-set-name" class="set-input" data-ja-placeholder="æ–°ã—ã„ã‚»ãƒƒãƒˆå" data-en-placeholder="New set name">
                <button class="btn" onclick="createNewSet()" data-ja="ä½œæˆ" data-en="Create">ä½œæˆ</button>
            </div>

            <div id="sets-list" class="sets-grid"></div>
        </div>

        <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰é¸æŠç”»é¢ -->
        <div id="spread-screen" class="screen">
            <div class="deck-info">
                <p><span data-ja="æœ‰åŠ¹ã‚«ãƒ¼ãƒ‰" data-en="Active Cards">æœ‰åŠ¹ã‚«ãƒ¼ãƒ‰</span>: <span id="spread-active-count">0</span><span data-ja="æš" data-en=""></span></p>
            </div>

            <div class="info-box" id="sig-toggle-box" style="display:none;">
                <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                    <input type="checkbox" id="use-sig-toggle" onchange="toggleSignificator()" style="width:20px;height:20px;">
                    <span data-ja="ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨" data-en="Use Significator">ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨</span>
                    <span id="sig-name-display" style="color:#64c8ff;font-size:12px;"></span>
                </label>
                <div style="font-size:11px;color:#888;margin-top:5px;" data-ja="å›ºå®šé…ç½®ç³»: æ‰€å®šä½ç½®ã«å›ºå®š / ã‚°ãƒ©ãƒ³ã‚¿ãƒ–ãƒ­ãƒ¼: å‡ºãŸä½ç½®ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ" data-en="Fixed spreads: Fixed position / Grand Tableau: Highlights position">
                    å›ºå®šé…ç½®ç³»: æ‰€å®šä½ç½®ã«å›ºå®š / ã‚°ãƒ©ãƒ³ã‚¿ãƒ–ãƒ­ãƒ¼: å‡ºãŸä½ç½®ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                </div>
            </div>

            <div class="info-box">
                <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                    <input type="checkbox" id="use-reversal-toggle" onchange="toggleReversal()" checked style="width:20px;height:20px;">
                    <span data-ja="æ­£é€†ã‚’å–ã‚‹" data-en="Use Reversals">æ­£é€†ã‚’å–ã‚‹</span>
                </label>
                <div style="font-size:11px;color:#888;margin-top:5px;" data-ja="OFFã«ã™ã‚‹ã¨ã‚«ãƒ¼ãƒ‰ã¯å¸¸ã«æ­£ä½ç½®ã§å‡ºã¾ã™ï¼ˆã‚ªãƒ©ã‚¯ãƒ«ã‚«ãƒ¼ãƒ‰å‘ã‘ï¼‰" data-en="Turn OFF to always draw cards upright (for oracle cards)">
                    OFFã«ã™ã‚‹ã¨ã‚«ãƒ¼ãƒ‰ã¯å¸¸ã«æ­£ä½ç½®ã§å‡ºã¾ã™ï¼ˆã‚ªãƒ©ã‚¯ãƒ«ã‚«ãƒ¼ãƒ‰å‘ã‘ï¼‰
                </div>
            </div>
            
            <div id="error-container"></div>
            
            <h2 style="margin:15px 0;font-size:1em;" data-ja="ãƒ™ãƒ¼ã‚·ãƒƒã‚¯" data-en="Basic">ãƒ™ãƒ¼ã‚·ãƒƒã‚¯</h2>
            <div class="spread-selection">
                <div class="spread-card" onclick="selectSpread('one', 1)">
                    <h3 data-ja="ãƒ¯ãƒ³ã‚ªãƒ©ã‚¯ãƒ«" data-en="One Card">ãƒ¯ãƒ³ã‚ªãƒ©ã‚¯ãƒ«</h3>
                    <p data-ja="1æš / ã‚·ãƒ³ãƒ—ãƒ«" data-en="1 card / Simple">1æš / ã‚·ãƒ³ãƒ—ãƒ«</p>
                </div>
                <div class="spread-card" onclick="selectSpread('simplecross', 2)">
                    <h3 data-ja="ã‚·ãƒ³ãƒ—ãƒ«ã‚¯ãƒ­ã‚¹" data-en="Simple Cross">ã‚·ãƒ³ãƒ—ãƒ«ã‚¯ãƒ­ã‚¹</h3>
                    <p data-ja="2æš / çŠ¶æ³ã¨éšœå®³" data-en="2 cards / Situation & Obstacle">2æš / çŠ¶æ³ã¨éšœå®³</p>
                </div>
                <div class="spread-card" onclick="selectSpread('choice', 3)">
                    <h3 data-ja="äºŒè€…æŠä¸€" data-en="Two Choices">äºŒè€…æŠä¸€</h3>
                    <p data-ja="3æš / é¸æŠè‚¢ã®æ¯”è¼ƒ" data-en="3 cards / Compare options">3æš / é¸æŠè‚¢ã®æ¯”è¼ƒ</p>
                </div>
                <div class="spread-card" onclick="selectSpread('three', 3)">
                    <h3 data-ja="ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰" data-en="Three Card">ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰</h3>
                    <p data-ja="3æš / éå»ç¾åœ¨æœªæ¥" data-en="3 cards / Past Present Future">3æš / éå»ç¾åœ¨æœªæ¥</p>
                </div>
            </div>
            
            <h2 style="margin:15px 0;font-size:1em;" data-ja="ã‚¯ãƒ­ã‚¹ç³»" data-en="Cross Spreads">ã‚¯ãƒ­ã‚¹ç³»</h2>
            <div class="spread-selection">
                <div class="spread-card" onclick="selectSpread('diamond', 4)">
                    <h3 data-ja="ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã‚¯ãƒ­ã‚¹" data-en="Diamond Cross">ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã‚¯ãƒ­ã‚¹</h3>
                    <p data-ja="4æš / è‡ªåˆ†ãƒ»ç›¸æ‰‹ãƒ»çµæœãƒ»å¯¾ç­–" data-en="4 cards / Self, Other, Result, Advice">4æš / è‡ªåˆ†ãƒ»ç›¸æ‰‹ãƒ»çµæœãƒ»å¯¾ç­–</p>
                </div>
                <div class="spread-card" onclick="selectSpread('greek', 5)">
                    <h3 data-ja="ã‚®ãƒªã‚·ãƒ£åå­—" data-en="Greek Cross">ã‚®ãƒªã‚·ãƒ£åå­—</h3>
                    <p data-ja="5æš / ç¾çŠ¶ãƒ»å‚¾å‘ãƒ»éšœå®³ãƒ»å¯¾ç­–ãƒ»çµæœ" data-en="5 cards / Current, Trend, Block, Advice, Result">5æš / ç¾çŠ¶ãƒ»å‚¾å‘ãƒ»éšœå®³ãƒ»å¯¾ç­–ãƒ»çµæœ</p>
                </div>
                <div class="spread-card" onclick="selectSpread('celtic', 10)">
                    <h3 data-ja="ã‚±ãƒ«ãƒˆåå­—" data-en="Celtic Cross">ã‚±ãƒ«ãƒˆåå­—</h3>
                    <p data-ja="10æš / è©³ç´°åˆ†æ" data-en="10 cards / Detailed analysis">10æš / è©³ç´°åˆ†æ</p>
                </div>
            </div>
            
            <h2 style="margin:15px 0;font-size:1em;" data-ja="ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ãƒ»Uå­—" data-en="Pyramid & Horseshoe">ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ãƒ»Uå­—</h2>
            <div class="spread-selection">
                <div class="spread-card" onclick="selectSpread('pyramid', 6)">
                    <h3 data-ja="ãƒ”ãƒ©ãƒŸãƒƒãƒ‰" data-en="Pyramid">ãƒ”ãƒ©ãƒŸãƒƒãƒ‰</h3>
                    <p data-ja="6æš / ç¾çŠ¶â†’è§£æ±ºâ†’æœ€çµ‚çµæœ" data-en="6 cards / Current â†’ Solution â†’ Final">6æš / ç¾çŠ¶â†’è§£æ±ºâ†’æœ€çµ‚çµæœ</p>
                </div>
                <div class="spread-card" onclick="selectSpread('horseshoe', 7)">
                    <h3 data-ja="ãƒ›ãƒ¼ã‚¹ã‚·ãƒ¥ãƒ¼" data-en="Horseshoe">ãƒ›ãƒ¼ã‚¹ã‚·ãƒ¥ãƒ¼</h3>
                    <p data-ja="7æš / Uå­—å±•é–‹" data-en="7 cards / U-shape spread">7æš / Uå­—å±•é–‹</p>
                </div>
                <div class="spread-card" onclick="selectSpread('hexagram', 7)">
                    <h3 data-ja="ãƒ˜ã‚­ã‚µã‚°ãƒ©ãƒ " data-en="Hexagram">ãƒ˜ã‚­ã‚µã‚°ãƒ©ãƒ </h3>
                    <p data-ja="7æš / å…­èŠ’æ˜Ÿ" data-en="7 cards / Star of David">7æš / å…­èŠ’æ˜Ÿ</p>
                </div>
            </div>
            
            <h2 style="margin:15px 0;font-size:1em;" data-ja="å¤§å±•é–‹" data-en="Grand Spreads">å¤§å±•é–‹</h2>
            <div class="spread-selection">
                <div class="spread-card" onclick="selectSpread('nine', 9)">
                    <h3 data-ja="ãƒŠã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰" data-en="Nine Card">ãƒŠã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰</h3>
                    <p data-ja="9æš / 3Ã—3" data-en="9 cards / 3Ã—3 Grid">9æš / 3Ã—3</p>
                </div>
                <div class="spread-card" onclick="selectSpread('lifetree', 10)">
                    <h3 data-ja="ç”Ÿå‘½ã®æ¨¹" data-en="Tree of Life">ç”Ÿå‘½ã®æ¨¹</h3>
                    <p data-ja="10æš / ã‚»ãƒ•ã‚£ãƒ­ãƒˆ" data-en="10 cards / Sephiroth">10æš / ã‚»ãƒ•ã‚£ãƒ­ãƒˆ</p>
                </div>
                <div class="spread-card" onclick="selectSpread('horoscope', 12)">
                    <h3 data-ja="ãƒ›ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—" data-en="Horoscope">ãƒ›ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—</h3>
                    <p data-ja="12æš / 12ãƒã‚¦ã‚¹" data-en="12 cards / 12 Houses">12æš / 12ãƒã‚¦ã‚¹</p>
                </div>
                <div class="spread-card" onclick="selectSpread('grand', 36)">
                    <h3 data-ja="ã‚°ãƒ©ãƒ³ã‚¿ãƒ–ãƒ­ãƒ¼" data-en="Grand Tableau">ã‚°ãƒ©ãƒ³ã‚¿ãƒ–ãƒ­ãƒ¼</h3>
                    <p data-ja="36æš / å¤§å±•é–‹" data-en="36 cards / Full spread">36æš / å¤§å±•é–‹</p>
                </div>
            </div>
        </div>

        <!-- ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
        <div id="reading-screen" class="screen">
            <!-- å•ã„è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="question-display" style="display:none;background:rgba(100,200,255,0.1);padding:12px;border-radius:8px;margin-bottom:15px;border:1px solid rgba(100,200,255,0.3);">
                <div style="font-size:11px;color:#64c8ff;margin-bottom:5px;" data-ja="ğŸ“ å•ã„" data-en="ğŸ“ Question">ğŸ“ å•ã„</div>
                <div id="question-text" style="font-size:14px;color:#fff;"></div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="shuffleAndDraw()" data-ja="ã‚·ãƒ£ãƒƒãƒ•ãƒ«" data-en="Shuffle">ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
                <button class="btn" onclick="skipShuffle()" data-ja="ã‚¹ã‚­ãƒƒãƒ—" data-en="Skip">ã‚¹ã‚­ãƒƒãƒ—</button>
                <button class="btn" onclick="resetReading()" data-ja="ãƒªã‚»ãƒƒãƒˆ" data-en="Reset">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            
            <div id="spread-display" class="spread-display">
                <div id="spread-inner" class="spread-inner"></div>
            </div>
            
            <!-- è£œè¶³ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="supplement-area" style="display:none;margin-top:20px;padding:15px;background:rgba(255,200,100,0.1);border:2px solid rgba(255,200,100,0.5);border-radius:12px;">
                <h4 style="color:#ffcc66;margin-bottom:10px;font-size:14px;" data-ja="è£œè¶³ã‚«ãƒ¼ãƒ‰" data-en="Supplement Cards">è£œè¶³ã‚«ãƒ¼ãƒ‰</h4>
                <div id="supplement-cards" style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;"></div>
            </div>
            
            <div id="result-info" class="result-info" style="display:none;"></div>
        </div>

        <!-- ãã˜å¼•ãç”»é¢ -->
        <div id="lottery-screen" class="screen">
            <div style="text-align:center;padding:20px;">
                <h2 style="color:#64c8ff;margin-bottom:15px;" data-ja="ğŸ² ãã˜å¼•ã" data-en="ğŸ² Random Draw">ğŸ² ãã˜å¼•ã</h2>
                <p style="color:#888;font-size:13px;margin-bottom:20px;" data-ja="ã‚«ãƒ¼ãƒ‰ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å¼•ãã¾ã™ã€‚ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã¾ã§åŒã˜ã‚«ãƒ¼ãƒ‰ã¯å‡ºã¾ã›ã‚“ã€‚" data-en="Draw cards randomly. Same card won't appear until reset.">ã‚«ãƒ¼ãƒ‰ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å¼•ãã¾ã™ã€‚ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã¾ã§åŒã˜ã‚«ãƒ¼ãƒ‰ã¯å‡ºã¾ã›ã‚“ã€‚</p>
                
                <div style="background:rgba(100,200,255,0.1);padding:15px;border-radius:10px;margin-bottom:20px;">
                    <div style="margin-bottom:10px;">
                        <span data-ja="å¼•ãæšæ•°: " data-en="Draw count: ">å¼•ãæšæ•°: </span>
                        <select id="lottery-count" style="padding:8px 15px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:6px;font-size:16px;">
                        </select>
                    </div>
                    <div style="font-size:14px;color:#64c8ff;">
                        <span data-ja="æ®‹ã‚Š: " data-en="Remaining: ">æ®‹ã‚Š: </span><span id="lottery-remaining">0</span><span data-ja="æš" data-en=" cards">æš</span>
                    </div>
                </div>
                
                <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:20px;">
                    <button class="btn" onclick="drawLottery()" style="padding:15px 30px;font-size:16px;" data-ja="å¼•ãï¼" data-en="Draw!">å¼•ãï¼</button>
                    <button class="btn" onclick="resetLottery()" style="padding:15px 20px;background:rgba(220,53,69,0.3);border-color:#dc3545;" data-ja="ãƒªã‚»ãƒƒãƒˆ" data-en="Reset">ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
                
                <!-- å¼•ã„ãŸã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="lottery-result" style="display:flex;flex-wrap:wrap;gap:15px;justify-content:center;"></div>
            </div>
        </div>

        <!-- å„€å¼ç”»é¢ -->
        <div id="ritual-screen" class="screen">
            <div class="ritual-container">
                <div class="ritual-section">
                    <h3 data-ja="1. æº–å‚™" data-en="1. Prepare">1. æº–å‚™</h3>
                    <p data-ja="æ·±å‘¼å¸ã‚’3å›ã€‚å¿ƒã‚’è½ã¡ç€ã‘ã¦è³ªå•ã«é›†ä¸­ã—ã¾ã™ã€‚" data-en="Take 3 deep breaths. Focus your mind on your question.">æ·±å‘¼å¸ã‚’3å›ã€‚å¿ƒã‚’è½ã¡ç€ã‘ã¦è³ªå•ã«é›†ä¸­ã—ã¾ã™ã€‚</p>
                    <button class="btn" onclick="startBreathing()" id="breathBtn" data-ja="æ·±å‘¼å¸ã‚’å§‹ã‚ã‚‹" data-en="Start Breathing">æ·±å‘¼å¸ã‚’å§‹ã‚ã‚‹</button>
                    <div id="breathTimer" style="margin-top:12px;font-size:1.2em;color:#64c8ff;"></div>
                </div>

                <div class="ritual-section">
                    <h3 data-ja="2. å•ã„ã‚’ç«‹ã¦ã‚‹" data-en="2. Set Your Question">2. å•ã„ã‚’ç«‹ã¦ã‚‹</h3>
                    <div class="question-list">
                        <p style="color:#888;font-size:12px;margin-bottom:8px;" data-ja="ä¾‹:" data-en="Examples:">ä¾‹:</p>
                        <ul style="padding:0;">
                            <li onclick="setQuestion(this.textContent)" data-ja="ä»ŠçŸ¥ã‚‹ã¹ãã“ã¨ã¯ä½•ï¼Ÿ" data-en="What do I need to know right now?">ä»ŠçŸ¥ã‚‹ã¹ãã“ã¨ã¯ä½•ï¼Ÿ</li>
                            <li onclick="setQuestion(this.textContent)" data-ja="ä½•ãŒé€²æ­©ã‚’å¦¨ã’ã¦ã„ã‚‹ï¼Ÿ" data-en="What is blocking my progress?">ä½•ãŒé€²æ­©ã‚’å¦¨ã’ã¦ã„ã‚‹ï¼Ÿ</li>
                            <li onclick="setQuestion(this.textContent)" data-ja="ä»Šæ—¥ã¯ä½•ã«é›†ä¸­ã™ã¹ãï¼Ÿ" data-en="What should I focus on today?">ä»Šæ—¥ã¯ä½•ã«é›†ä¸­ã™ã¹ãï¼Ÿ</li>
                        </ul>
                    </div>
                    <textarea id="questionInput" data-ja-placeholder="å•ã„ã‚’å…¥åŠ›..." data-en-placeholder="Enter your question..."></textarea>
                </div>

                <div class="ritual-section">
                    <h3 data-ja="3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚’é¸ã¶" data-en="3. Choose a Spread">3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚’é¸ã¶</h3>
                    <button class="btn" onclick="goToSpread()" data-ja="å±•é–‹ç”»é¢ã¸" data-en="Go to Spreads">å±•é–‹ç”»é¢ã¸</button>
                </div>

                <div class="ritual-section">
                    <h3 data-ja="4. æŒ¯ã‚Šè¿”ã‚Š" data-en="4. Reflect">4. æŒ¯ã‚Šè¿”ã‚Š</h3>
                    <p data-ja="ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‹ã‚‰å¾—ãŸæ°—ã¥ãã‚’æ›¸ãç•™ã‚ã¾ã™ã€‚" data-en="Write down the key insight from your reading.">ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‹ã‚‰å¾—ãŸæ°—ã¥ãã‚’æ›¸ãç•™ã‚ã¾ã™ã€‚</p>
                    <p style="font-size:11px;color:#888;margin-top:5px;" data-ja="â€»æœ€æ–°20ä»¶ã¾ã§ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆå¤ã„ã‚‚ã®ã¯è‡ªå‹•å‰Šé™¤ï¼‰" data-en="â€»Up to 20 entries saved (older ones auto-deleted)">â€»æœ€æ–°20ä»¶ã¾ã§ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆå¤ã„ã‚‚ã®ã¯è‡ªå‹•å‰Šé™¤ï¼‰</p>
                    <textarea id="crystalNote" data-ja-placeholder="æ°—ã¥ãã‚’è¨˜éŒ²..." data-en-placeholder="Your insight..."></textarea>
                    <button class="btn" onclick="saveCrystal()" style="margin-top:10px;" data-ja="ä¿å­˜" data-en="Save">ä¿å­˜</button>
                    
                    <div style="margin-top:20px;">
                        <h4 style="color:#64c8ff;margin-bottom:10px;font-size:0.9em;" data-ja="éå»ã®è¨˜éŒ²" data-en="Past Insights">éå»ã®è¨˜éŒ²</h4>
                        <div id="crystalList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal-overlay" id="imageModal" onclick="closeImageModal()">
        <div class="modal-close">&times;</div>
        <img class="modal-image" id="modalImage" src="">
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let masterCards = [];
        let cardSets = {};
        let currentSetName = 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ';
        let currentSpread = null;
        let currentSpreadSize = 0;
        let drawnCards = [];
        let backCardImage = '';
        let significatorId = null; // ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼
        let useSignificator = false; // ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼ä½¿ç”¨ãƒ•ãƒ©ã‚°
        let useReversal = true; // æ­£é€†ã‚’å–ã‚‹ã‹ã©ã†ã‹
        let currentLang = 'ja'; // è¨€èªè¨­å®š
        
        // è¨€èªåˆ‡ã‚Šæ›¿ãˆ
        function changeLang(lang) {
            currentLang = lang;
            localStorage.setItem('oracleLang', lang);
            
            // data-ja, data-enå±æ€§ã‚’æŒã¤è¦ç´ ã‚’æ›´æ–°
            document.querySelectorAll('[data-ja][data-en]').forEach(el => {
                el.textContent = lang === 'ja' ? el.dataset.ja : el.dataset.en;
            });
            
            // placeholderã®åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('[data-ja-placeholder][data-en-placeholder]').forEach(el => {
                el.placeholder = lang === 'ja' ? el.dataset.jaPlaceholder : el.dataset.enPlaceholder;
            });
            
            // å‹•çš„ç”Ÿæˆã•ã‚Œã‚‹UIã‚‚æ›´æ–°
            renderCards();
            updateStorageInfo();
            updateSignificatorDisplay();
        }
        
        // è¨€èªã«å¿œã˜ãŸãƒ†ã‚­ã‚¹ãƒˆå–å¾—
        function getLang(key, ja, en) {
            return currentLang === 'ja' ? ja : en;
        }
        
        // ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹
        function goHome() {
            const title = document.getElementById('titleScreen');
            title.style.display = 'flex';
            title.style.pointerEvents = 'auto';
            title.style.opacity = '0';
            setTimeout(() => {
                title.style.opacity = '1';
            }, 50);
        }
        
        // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‚’é–‰ã˜ã‚‹
        function hideTitle() {
            const title = document.getElementById('titleScreen');
            title.style.opacity = '0';
            title.style.pointerEvents = 'none';
            setTimeout(() => {
                title.style.display = 'none';
            }, 500);
        }
        
        // åˆæœŸåŒ–
        function init() {
            // è¨€èªè¨­å®šã‚’èª­ã¿è¾¼ã¿
            const savedLang = localStorage.getItem('oracleLang');
            if (savedLang) {
                currentLang = savedLang;
                document.getElementById('lang-select').value = savedLang;
                changeLang(savedLang);
            }
            
            const savedMaster = localStorage.getItem('oracleCards');
            if (savedMaster) {
                masterCards = JSON.parse(savedMaster);
            } else {
                for (let i = 0; i < 10; i++) {
                    masterCards.push({
                        id: i,
                        name: `Card ${i + 1}`,
                        description: '',
                        imageData: ''
                    });
                }
                saveMasterCards();
            }

            const savedSets = localStorage.getItem('oracleSets');
            if (savedSets) {
                cardSets = JSON.parse(savedSets);
            } else {
                cardSets = {'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ': masterCards.map(c => c.id)};
                saveSets();
            }

            const savedCurrentSet = localStorage.getItem('oracleCurrentSet');
            if (savedCurrentSet && cardSets[savedCurrentSet]) {
                currentSetName = savedCurrentSet;
            }
            
            const savedBack = localStorage.getItem('oracleBackImage');
            if (savedBack) {
                backCardImage = savedBack;
                updateBackPreview();
            }
            
            const savedSig = localStorage.getItem('oracleSignificator');
            if (savedSig !== null) {
                significatorId = parseInt(savedSig);
            }
            
            const savedReversal = localStorage.getItem('oracleUseReversal');
            if (savedReversal !== null) {
                useReversal = savedReversal === 'true';
            }
            
            renderCards();
            updateActiveCount();
            renderSetsList();
            updateStorageInfo();
            updateSignificatorDisplay();
        }

        function saveMasterCards() {
            try {
                localStorage.setItem('oracleCards', JSON.stringify(masterCards));
            } catch(e) {
                alert('ä¿å­˜å®¹é‡ã‚’è¶…ãˆã¾ã—ãŸã€‚ç”»åƒã‚µã‚¤ã‚ºã‚’å°ã•ãã—ã¦ãã ã•ã„ã€‚');
            }
        }

        function saveSets() {
            localStorage.setItem('oracleSets', JSON.stringify(cardSets));
        }

        function getCurrentCards() {
            const cardIds = cardSets[currentSetName] || [];
            return cardIds.map(id => masterCards.find(c => c.id === id)).filter(Boolean);
        }

        function updateStorageInfo() {
            const storageInfo = document.getElementById('storage-info');
            const storageWarning = document.getElementById('storage-warning');
            if (!storageInfo || !storageWarning) return;
            
            let total = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    total += localStorage[key].length * 2;
                }
            }
            const mb = (total / 1024 / 1024).toFixed(2);
            const usageText = currentLang === 'ja' ? 'ä½¿ç”¨é‡' : 'Storage';
            storageInfo.textContent = `${usageText}: ${mb} MB`;
            
            if (total > 4 * 1024 * 1024) {
                storageWarning.style.display = 'block';
            } else {
                storageWarning.style.display = 'none';
            }
        }

        // ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼é–¢é€£
        function updateSignificatorDisplay() {
            const preview = document.getElementById('sig-preview');
            const toggleBox = document.getElementById('sig-toggle-box');
            const nameDisplay = document.getElementById('sig-name-display');
            
            // è¦ç´ ãŒãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (!preview || !toggleBox || !nameDisplay) return;
            
            const notSetText = currentLang === 'ja' ? 'æœªè¨­å®š' : 'Not set';
            
            if (significatorId !== null) {
                const card = masterCards.find(c => c.id === significatorId);
                if (card) {
                    if (card.imageData) {
                        preview.innerHTML = `<img src="${card.imageData}">`;
                    } else {
                        preview.innerHTML = card.name;
                    }
                    toggleBox.style.display = 'block';
                    nameDisplay.textContent = `(${card.name})`;
                } else {
                    significatorId = null;
                    preview.innerHTML = notSetText;
                    toggleBox.style.display = 'none';
                }
            } else {
                preview.innerHTML = notSetText;
                toggleBox.style.display = 'none';
            }
        }

        function openSignificatorSelect() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:10000;overflow:auto;padding:20px;';
            
            const activeCards = getCurrentCards();
            
            let cardList = '';
            activeCards.forEach(card => {
                const selected = card.id === significatorId ? 'border-color:rgba(255,200,100,0.8);background:rgba(255,200,100,0.2);' : '';
                const preview = card.imageData 
                    ? `<img src="${card.imageData}" style="width:100%;height:100%;object-fit:cover;">`
                    : card.name;
                cardList += `
                    <div onclick="selectSignificator(${card.id})" style="cursor:pointer;padding:10px;background:rgba(255,255,255,0.05);border:2px solid rgba(255,255,255,0.2);border-radius:8px;text-align:center;${selected}">
                        <div style="width:60px;height:90px;margin:0 auto 8px;background:#2a2a4a;border-radius:4px;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:10px;color:#888;">
                            ${preview}
                        </div>
                        <div style="font-size:12px;">${card.name}</div>
                    </div>
                `;
            });
            
            modal.innerHTML = `
                <div style="max-width:600px;margin:0 auto;background:rgba(15,32,39,0.98);padding:20px;border-radius:12px;border:2px solid rgba(255,200,100,0.5);">
                    <h2 style="color:#ffcc66;margin-bottom:15px;font-size:1.1em;">ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’é¸æŠ</h2>
                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px;max-height:60vh;overflow-y:auto;">
                        ${cardList}
                    </div>
                    <div style="margin-top:15px;text-align:center;">
                        <button onclick="closeSignificatorModal()" class="btn" style="padding:12px 25px;">é–‰ã˜ã‚‹</button>
                    </div>
                </div>
            `;
            
            modal.id = 'sig-modal';
            document.body.appendChild(modal);
        }

        function selectSignificator(id) {
            significatorId = id;
            localStorage.setItem('oracleSignificator', id);
            updateSignificatorDisplay();
            closeSignificatorModal();
        }

        function clearSignificator() {
            significatorId = null;
            localStorage.removeItem('oracleSignificator');
            useSignificator = false;
            document.getElementById('use-sig-toggle').checked = false;
            updateSignificatorDisplay();
        }

        function closeSignificatorModal() {
            const modal = document.getElementById('sig-modal');
            if (modal) modal.remove();
        }

        function toggleSignificator() {
            useSignificator = document.getElementById('use-sig-toggle').checked;
        }

        function toggleReversal() {
            useReversal = document.getElementById('use-reversal-toggle').checked;
        }

        // ç”»åƒã‚’Base64ã«å¤‰æ›ï¼ˆãƒªã‚µã‚¤ã‚ºä»˜ãï¼‰
        function imageToBase64(file, maxSize, callback) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let w = img.width;
                    let h = img.height;
                    
                    if (w > maxSize || h > maxSize) {
                        if (w > h) {
                            h = h * maxSize / w;
                            w = maxSize;
                        } else {
                            w = w * maxSize / h;
                            h = maxSize;
                        }
                    }
                    
                    canvas.width = w;
                    canvas.height = h;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, w, h);
                    callback(canvas.toDataURL('image/jpeg', 0.7));
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function selectBackImage(input) {
            const file = input.files[0];
            if (file) {
                imageToBase64(file, 300, function(data) {
                    backCardImage = data;
                    localStorage.setItem('oracleBackImage', backCardImage);
                    updateBackPreview();
                    updateStorageInfo();
                });
            }
        }
        
        function updateBackPreview() {
            const preview = document.getElementById('back-preview');
            if (!preview) return;
            if (backCardImage) {
                preview.innerHTML = `<img src="${backCardImage}">`;
            } else {
                preview.innerHTML = 'ğŸ”®';
            }
        }
        
        function setCardCount() {
            const count = parseInt(document.getElementById('card-count-input').value);
            if (count < 1 || count > 150) {
                alert(currentLang === 'ja' ? '1ã€œ150æšã§è¨­å®šã—ã¦ãã ã•ã„' : 'Please set between 1-150 cards');
                return;
            }
            
            const currentCount = masterCards.length;
            const cardPrefix = currentLang === 'ja' ? 'ã‚«ãƒ¼ãƒ‰' : 'Card';
            if (count > currentCount) {
                for (let i = currentCount; i < count; i++) {
                    masterCards.push({
                        id: i,
                        name: `${cardPrefix} ${i + 1}`,
                        description: '',
                        imageData: ''
                    });
                }
            } else if (count < currentCount) {
                masterCards = masterCards.slice(0, count);
                Object.keys(cardSets).forEach(setName => {
                    cardSets[setName] = cardSets[setName].filter(id => id < count);
                });
            }
            
            saveMasterCards();
            saveSets();
            renderCards();
            updateActiveCount();
            updateStorageInfo();
        }
        
        function renderCards() {
            const grid = document.getElementById('card-grid');
            grid.innerHTML = '';
            
            masterCards.forEach((card, index) => {
                const item = document.createElement('div');
                item.className = 'card-item';
                
                const noImageText = currentLang === 'ja' ? 'ç”»åƒãªã—' : 'No image';
                const previewContent = card.imageData 
                    ? `<img src="${card.imageData}">`
                    : noImageText;
                
                const namePlaceholder = currentLang === 'ja' ? 'åå‰' : 'Name';
                const descPlaceholder = currentLang === 'ja' ? 'èª¬æ˜' : 'Description';
                const uploadBtnText = currentLang === 'ja' ? 'ç”»åƒé¸æŠ' : 'Select Image';
                
                item.innerHTML = `
                    <div class="card-number">No.${index + 1}</div>
                    <div class="card-preview" id="preview-${index}">${previewContent}</div>
                    <input type="text" placeholder="${namePlaceholder}" value="${card.name}" 
                           onchange="updateCardName(${index}, this.value)">
                    <textarea placeholder="${descPlaceholder}" onchange="updateCardDesc(${index}, this.value)">${card.description}</textarea>
                    <input type="file" accept="image/*" style="display:none" 
                           id="file-${index}" onchange="selectImageFile(${index}, this)">
                    <button class="upload-btn" onclick="document.getElementById('file-${index}').click()">
                        ${uploadBtnText}
                    </button>
                `;
                grid.appendChild(item);
            });
        }
        
        function updateCardName(index, value) {
            masterCards[index].name = value;
            saveMasterCards();
        }
        
        function updateCardDesc(index, value) {
            masterCards[index].description = value;
            saveMasterCards();
        }
        
        function selectImageFile(index, input) {
            const file = input.files[0];
            if (file) {
                imageToBase64(file, 400, function(data) {
                    masterCards[index].imageData = data;
                    saveMasterCards();
                    
                    const preview = document.getElementById(`preview-${index}`);
                    preview.innerHTML = `<img src="${data}">`;
                    updateStorageInfo();
                });
            }
        }
        
        function updateActiveCount() {
            const count = getCurrentCards().length;
            document.getElementById('master-count').textContent = masterCards.length;
            document.getElementById('active-count').textContent = count;
            document.getElementById('spread-active-count').textContent = count;
        }
        
        function showScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
            
            document.getElementById(`${screen}-screen`).classList.add('active');
            event.target.classList.add('active');
            
            if (screen === 'spread') {
                updateActiveCount();
            } else if (screen === 'sets') {
                renderSetsList();
            } else if (screen === 'ritual') {
                loadCrystals();
            } else if (screen === 'lottery') {
                initLottery();
            } else if (screen === 'reading') {
                loadQuestion();
            }
        }
        
        // å•ã„ã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤º
        function loadQuestion() {
            const question = localStorage.getItem('oracleQuestion');
            const display = document.getElementById('question-display');
            const text = document.getElementById('question-text');
            
            if (question && question.trim()) {
                text.textContent = question;
                display.style.display = 'block';
            } else {
                display.style.display = 'none';
            }
        }
        
        // ãã˜å¼•ãæ©Ÿèƒ½
        let lotteryPool = [];
        
        function initLottery() {
            if (lotteryPool.length === 0) {
                resetLottery();
            }
            updateLotteryUI();
        }
        
        function resetLottery() {
            lotteryPool = [...getCurrentCards()];
            document.getElementById('lottery-result').innerHTML = '';
            updateLotteryUI();
        }
        
        function updateLotteryUI() {
            const remaining = lotteryPool.length;
            document.getElementById('lottery-remaining').textContent = remaining;
            
            // å¼•ãæšæ•°ã‚»ãƒ¬ã‚¯ãƒˆæ›´æ–°
            const select = document.getElementById('lottery-count');
            select.innerHTML = '';
            const maxDraw = Math.min(remaining, 10);
            for (let i = 1; i <= maxDraw; i++) {
                const opt = document.createElement('option');
                opt.value = i;
                opt.textContent = i;
                opt.style.color = '#000';
                opt.style.background = '#fff';
                select.appendChild(opt);
            }
            if (maxDraw === 0) {
                const opt = document.createElement('option');
                opt.value = 0;
                opt.textContent = '0';
                opt.style.color = '#000';
                opt.style.background = '#fff';
                select.appendChild(opt);
            }
        }
        
        function drawLottery() {
            const count = parseInt(document.getElementById('lottery-count').value);
            if (count <= 0 || lotteryPool.length < count) {
                alert(currentLang === 'ja' ? 'ã‚«ãƒ¼ãƒ‰ãŒè¶³ã‚Šã¾ã›ã‚“' : 'Not enough cards');
                return;
            }
            
            const resultDiv = document.getElementById('lottery-result');
            
            for (let i = 0; i < count; i++) {
                const randIdx = Math.floor(Math.random() * lotteryPool.length);
                const card = lotteryPool.splice(randIdx, 1)[0];
                
                // ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆå¤§ãã‚ï¼‰
                const cardDiv = document.createElement('div');
                cardDiv.style.cssText = 'width:120px;text-align:center;animation:fadeIn 0.5s;';
                
                const cardInner = document.createElement('div');
                cardInner.style.cssText = `
                    width:120px;height:180px;
                    border-radius:10px;
                    overflow:hidden;
                    border:3px solid rgba(100,200,255,0.8);
                    box-shadow:0 0 20px rgba(100,200,255,0.5);
                    cursor:pointer;
                `;
                
                if (card.imageData) {
                    cardInner.innerHTML = `<img src="${card.imageData}" style="width:100%;height:100%;object-fit:cover;">`;
                } else {
                    cardInner.innerHTML = `<div style="width:100%;height:100%;background:linear-gradient(135deg,#2a2a4a,#1a1a2e);display:flex;align-items:center;justify-content:center;font-size:14px;color:#64c8ff;padding:10px;text-align:center;">${card.name}</div>`;
                }
                
                cardInner.onclick = () => showCardModal(card);
                
                const label = document.createElement('div');
                label.style.cssText = 'font-size:12px;margin-top:8px;color:#fff;';
                label.textContent = card.name;
                
                cardDiv.appendChild(cardInner);
                cardDiv.appendChild(label);
                resultDiv.appendChild(cardDiv);
            }
            
            updateLotteryUI();
        }

        // ã‚»ãƒƒãƒˆç®¡ç†
        function createNewSet() {
            const setName = document.getElementById('new-set-name').value.trim();
            if (!setName) {
                alert('ã‚»ãƒƒãƒˆåã‚’å…¥åŠ›');
                return;
            }
            if (cardSets[setName]) {
                alert('æ—¢ã«å­˜åœ¨ã—ã¾ã™');
                return;
            }

            cardSets[setName] = [];
            saveSets();
            document.getElementById('new-set-name').value = '';
            renderSetsList();
        }

        function switchSet(setName) {
            if (!cardSets[setName]) return;
            currentSetName = setName;
            localStorage.setItem('oracleCurrentSet', currentSetName);
            updateActiveCount();
            renderSetsList();
        }

        function deleteSet(setName) {
            if (setName === 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ') {
                alert('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å‰Šé™¤ä¸å¯');
                return;
            }
            if (!confirm(`ã€Œ${setName}ã€ã‚’å‰Šé™¤?`)) return;
            
            delete cardSets[setName];
            if (currentSetName === setName) {
                switchSet('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ');
            }
            saveSets();
            renderSetsList();
        }

        function renderSetsList() {
            const list = document.getElementById('sets-list');
            list.innerHTML = '';
            document.getElementById('current-set-name').textContent = currentSetName;
            
            const cardsText = currentLang === 'ja' ? 'æš' : ' cards';
            const activeText = currentLang === 'ja' ? 'âœ“ ä½¿ç”¨ä¸­' : 'âœ“ Active';
            const editText = currentLang === 'ja' ? 'ç·¨é›†' : 'Edit';
            const switchText = currentLang === 'ja' ? 'åˆ‡æ›¿' : 'Switch';
            const deleteText = currentLang === 'ja' ? 'å‰Šé™¤' : 'Delete';
            
            Object.keys(cardSets).forEach(setName => {
                const setCard = document.createElement('div');
                setCard.className = 'spread-card';
                if (setName === currentSetName) {
                    setCard.style.borderColor = 'rgba(100,200,255,0.8)';
                    setCard.style.background = 'rgba(100,200,255,0.2)';
                }
                
                const cardCount = cardSets[setName].length;
                
                let html = `<h3>${setName}</h3><p>${cardCount}${cardsText}</p>`;
                if (setName === currentSetName) {
                    html += `<p style="color:#64c8ff;font-size:12px;">${activeText}</p>`;
                    html += `<button class="btn" style="padding:8px 12px;font-size:12px;margin-top:8px;" onclick="editSetCards()">${editText}</button>`;
                } else {
                    html += `<button class="btn" style="padding:8px 12px;font-size:12px;margin-top:8px;" onclick="switchSet('${setName}')">${switchText}</button>`;
                }
                
                if (setName !== 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ' && setName !== 'Default') {
                    html += `<button class="btn" style="padding:8px 12px;font-size:12px;margin-top:8px;background:rgba(220,53,69,0.5);border-color:#dc3545;" onclick="deleteSet('${setName}')">${deleteText}</button>`;
                }
                
                setCard.innerHTML = html;
                list.appendChild(setCard);
            });
        }

        function editSetCards() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:10000;overflow:auto;padding:20px;';
            
            const currentCardIds = cardSets[currentSetName] || [];
            
            let checkboxes = '';
            masterCards.forEach(card => {
                const checked = currentCardIds.includes(card.id) ? 'checked' : '';
                checkboxes += `
                    <label style="display:flex;align-items:center;padding:10px;background:rgba(255,255,255,0.05);margin:5px 0;border-radius:4px;">
                        <input type="checkbox" value="${card.id}" ${checked} style="margin-right:10px;width:20px;height:20px;">
                        <span style="font-size:14px;">No.${card.id + 1}: ${card.name}</span>
                    </label>
                `;
            });
            
            modal.innerHTML = `
                <div style="max-width:600px;margin:0 auto;background:rgba(15,32,39,0.98);padding:20px;border-radius:12px;border:2px solid rgba(100,200,255,0.5);">
                    <h2 style="color:#64c8ff;margin-bottom:15px;font-size:1.1em;">ã€Œ${currentSetName}ã€ã‚’ç·¨é›†</h2>
                    <div style="margin-bottom:15px;">
                        <button onclick="selectAllCards(true)" class="btn" style="padding:8px 15px;font-size:12px;margin:3px;">å…¨é¸æŠ</button>
                        <button onclick="selectAllCards(false)" class="btn" style="padding:8px 15px;font-size:12px;margin:3px;">å…¨è§£é™¤</button>
                    </div>
                    <div id="card-checkboxes" style="max-height:50vh;overflow-y:auto;">${checkboxes}</div>
                    <div style="margin-top:15px;text-align:center;">
                        <button onclick="saveSetCards()" class="btn" style="padding:12px 25px;margin:5px;">ä¿å­˜</button>
                        <button onclick="closeSetModal()" class="btn" style="padding:12px 25px;margin:5px;background:rgba(220,53,69,0.5);border-color:#dc3545;">é–‰ã˜ã‚‹</button>
                    </div>
                </div>
            `;
            
            modal.id = 'set-modal';
            document.body.appendChild(modal);
        }

        function selectAllCards(select) {
            document.querySelectorAll('#card-checkboxes input').forEach(cb => cb.checked = select);
        }

        function saveSetCards() {
            const checked = document.querySelectorAll('#card-checkboxes input:checked');
            const ids = Array.from(checked).map(cb => parseInt(cb.value));
            
            if (ids.length < 1) {
                alert('æœ€ä½1æšé¸æŠ');
                return;
            }
            
            cardSets[currentSetName] = ids;
            saveSets();
            updateActiveCount();
            renderSetsList();
            closeSetModal();
        }

        function closeSetModal() {
            const modal = document.getElementById('set-modal');
            if (modal) modal.remove();
        }
        
        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰
        function selectSpread(type, size) {
            const activeCards = getCurrentCards();
            const errorContainer = document.getElementById('error-container');
            
            if (activeCards.length < size) {
                errorContainer.innerHTML = `<div class="error-message">${size}æšå¿…è¦ã§ã™ï¼ˆç¾åœ¨${activeCards.length}æšï¼‰</div>`;
                return;
            }
            
            errorContainer.innerHTML = '';
            currentSpread = type;
            currentSpreadSize = size;
            
            showScreen('reading');
            document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
            document.querySelector('.nav-tabs button:nth-child(4)').classList.add('active');
            setupSpread(type, size);
        }
        
        function setupSpread(type, size) {
            const inner = document.getElementById('spread-inner');
            inner.innerHTML = '';
            document.getElementById('result-info').style.display = 'none';
            
            const positions = getSpreadPositions(type, size);
            
            positions.forEach((pos, i) => {
                const slot = document.createElement('div');
                slot.className = 'card-slot';
                slot.style.left = pos.x + 'px';
                slot.style.top = pos.y + 'px';
                slot.id = `slot-${i}`;
                slot.innerHTML = `<span>${pos.label || (i + 1)}</span>`;
                inner.appendChild(slot);
            });
        }
        
        function getSpreadPositions(type, size) {
            const positions = [];
            const isMobile = window.innerWidth < 768;
            // ãƒ¢ãƒã‚¤ãƒ«ã§ã¯å·¦ã«ä½™ç™½ã‚’ç¢ºä¿
            const offsetX = isMobile ? 50 : 0;
            const cx = 250 + offsetX;
            const cy = 200;
            
            switch(type) {
                case 'one':
                    positions.push({x: cx, y: cy, label: getLang('answer', 'ç­”', 'Answer')});
                    break;
                case 'simplecross':
                    // ã‚·ãƒ³ãƒ—ãƒ«ã‚¯ãƒ­ã‚¹ï¼ˆ2æšï¼‰- çŠ¶æ³ãŒä¸Šã€éšœå®³ãŒé‡ãªã‚‹
                    positions.push({x: cx, y: cy - 60, label: getLang('situation', 'çŠ¶æ³', 'Situation')});
                    positions.push({x: cx, y: cy + 60, label: getLang('obstacle', 'éšœå®³', 'Obstacle')});
                    break;
                case 'choice':
                    // äºŒè€…æŠä¸€ï¼ˆ3æšï¼‰
                    const choiceGap = isMobile ? 80 : 120;
                    positions.push({x: cx - choiceGap, y: cy - 60, label: getLang('choice1', 'é¸æŠâ‘ ', 'Choice 1')});
                    positions.push({x: cx + choiceGap, y: cy - 60, label: getLang('choice2', 'é¸æŠâ‘¡', 'Choice 2')});
                    positions.push({x: cx, y: cy + 80, label: getLang('situation', 'çŠ¶æ³', 'Situation')});
                    break;
                case 'three':
                    positions.push({x: cx - 120, y: cy, label: getLang('past', 'éå»', 'Past')});
                    positions.push({x: cx, y: cy, label: getLang('present', 'ç¾åœ¨', 'Present')});
                    positions.push({x: cx + 120, y: cy, label: getLang('future', 'æœªæ¥', 'Future')});
                    break;
                case 'diamond':
                    // ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã‚¯ãƒ­ã‚¹ï¼ˆ4æšï¼‰
                    const dGap = isMobile ? 70 : 100;
                    positions.push({x: cx, y: cy - dGap, label: getLang('result', 'çµæœ', 'Result')});
                    positions.push({x: cx - dGap, y: cy, label: getLang('self', 'è‡ªåˆ†', 'Self')});
                    positions.push({x: cx + dGap, y: cy, label: getLang('other', 'ç›¸æ‰‹', 'Other')});
                    positions.push({x: cx, y: cy + dGap, label: getLang('advice', 'å¯¾ç­–', 'Advice')});
                    break;
                case 'greek':
                    // ã‚®ãƒªã‚·ãƒ£åå­—ï¼ˆ5æšï¼‰
                    const gkGap = isMobile ? 70 : 100;
                    positions.push({x: cx, y: cy - gkGap, label: getLang('trend', 'å‚¾å‘', 'Trend')});
                    positions.push({x: cx - gkGap, y: cy, label: getLang('current', 'ç¾çŠ¶', 'Current')});
                    positions.push({x: cx, y: cy, label: getLang('result', 'çµæœ', 'Result')});
                    positions.push({x: cx + gkGap, y: cy, label: getLang('obstacle', 'éšœå®³', 'Obstacle')});
                    positions.push({x: cx, y: cy + gkGap, label: getLang('advice', 'å¯¾ç­–', 'Advice')});
                    break;
                case 'pyramid':
                    // ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ï¼ˆ6æšï¼‰
                    const pyGap = isMobile ? 60 : 80;
                    // åº•è¾ºï¼ˆç¾çŠ¶ãƒ»åŸå› ãƒ»éšœå®³ï¼‰
                    positions.push({x: cx - pyGap, y: cy + pyGap, label: getLang('current', 'ç¾çŠ¶', 'Current')});
                    positions.push({x: cx, y: cy + pyGap, label: getLang('cause', 'åŸå› ', 'Cause')});
                    positions.push({x: cx + pyGap, y: cy + pyGap, label: getLang('obstacle', 'éšœå®³', 'Obstacle')});
                    // ä¸­æ®µï¼ˆè§£æ±º1ãƒ»è§£æ±º2ï¼‰
                    positions.push({x: cx - pyGap/2, y: cy, label: getLang('solution1', 'è§£æ±ºâ‘ ', 'Solution 1')});
                    positions.push({x: cx + pyGap/2, y: cy, label: getLang('solution2', 'è§£æ±ºâ‘¡', 'Solution 2')});
                    // é ‚ç‚¹ï¼ˆæœ€çµ‚çµæœï¼‰
                    positions.push({x: cx, y: cy - pyGap, label: getLang('final', 'æœ€çµ‚çµæœ', 'Final')});
                    break;
                case 'horseshoe':
                    // ãƒ›ãƒ¼ã‚¹ã‚·ãƒ¥ãƒ¼ï¼ˆ7æšï¼‰- Uå­—å‹
                    const hsGap = isMobile ? 55 : 80;
                    const hsV = isMobile ? 50 : 70;
                    positions.push({x: cx - hsGap*2, y: cy - hsV*2, label: getLang('past', 'éå»', 'Past')});
                    positions.push({x: cx - hsGap*1.5, y: cy - hsV, label: getLang('present', 'ç¾åœ¨', 'Present')});
                    positions.push({x: cx - hsGap, y: cy, label: getLang('future', 'æœªæ¥', 'Future')});
                    positions.push({x: cx, y: cy + hsV, label: getLang('advice', 'ã‚¢ãƒ‰ãƒã‚¤ã‚¹', 'Advice')});
                    positions.push({x: cx + hsGap, y: cy, label: getLang('others', 'ç›¸æ‰‹ã®æ°—æŒã¡', 'Others')});
                    positions.push({x: cx + hsGap*1.5, y: cy - hsV, label: getLang('obstacle', 'éšœå®³', 'Obstacle')});
                    positions.push({x: cx + hsGap*2, y: cy - hsV*2, label: getLang('final', 'æœ€çµ‚çµæœ', 'Final')});
                    break;
                case 'hexagram':
                    // å…­èŠ’æ˜Ÿé…ç½®ï¼ˆ7æšï¼‰
                    const hGap = isMobile ? 70 : 100;
                    const hVGap = isMobile ? 60 : 80;
                    positions.push({x: cx, y: cy - hVGap * 1.5, label: '1'});
                    positions.push({x: cx - hGap, y: cy + hVGap * 0.5, label: '2'});
                    positions.push({x: cx + hGap, y: cy + hVGap * 0.5, label: '3'});
                    positions.push({x: cx - hGap, y: cy - hVGap * 0.5, label: '4'});
                    positions.push({x: cx + hGap, y: cy - hVGap * 0.5, label: '5'});
                    positions.push({x: cx, y: cy + hVGap * 1.5, label: '6'});
                    positions.push({x: cx, y: cy, label: '7'});
                    break;
                case 'celtic':
                    const cGap = isMobile ? 80 : 120;
                    positions.push({x: cx, y: cy, label: '1'});
                    positions.push({x: cx, y: cy, label: '2'});
                    positions.push({x: cx, y: cy - 100, label: '3'});
                    positions.push({x: cx, y: cy + 100, label: '4'});
                    positions.push({x: cx - cGap, y: cy, label: '5'});
                    positions.push({x: cx + cGap, y: cy, label: '6'});
                    positions.push({x: cx + cGap + 80, y: cy + 120, label: '7'});
                    positions.push({x: cx + cGap + 80, y: cy + 40, label: '8'});
                    positions.push({x: cx + cGap + 80, y: cy - 40, label: '9'});
                    positions.push({x: cx + cGap + 80, y: cy - 120, label: '10'});
                    break;
                case 'nine':
                    const nineGap = isMobile ? 80 : 120;
                    for (let r = 0; r < 3; r++) {
                        for (let c = 0; c < 3; c++) {
                            positions.push({x: cx - nineGap + c * nineGap, y: cy - 100 + r * 100, label: r * 3 + c + 1});
                        }
                    }
                    break;
                case 'lifetree':
                    // ç”Ÿå‘½ã®æ¨¹ï¼ˆ10æšï¼‰
                    const ltGap = isMobile ? 50 : 70;
                    const ltV = isMobile ? 45 : 60;
                    positions.push({x: cx, y: cy - ltV*3, label: getLang('crown', '1.ç†æƒ³', '1.Crown')});
                    positions.push({x: cx + ltGap, y: cy - ltV*2, label: getLang('wisdom', '2.æƒ…ç†±', '2.Passion')});
                    positions.push({x: cx - ltGap, y: cy - ltV*2, label: getLang('understanding', '3.ç†è§£', '3.Understanding')});
                    positions.push({x: cx + ltGap, y: cy - ltV, label: getLang('mercy', '4.æ…ˆæ‚²', '4.Mercy')});
                    positions.push({x: cx - ltGap, y: cy - ltV, label: getLang('severity', '5.å³»å³', '5.Severity')});
                    positions.push({x: cx, y: cy, label: getLang('beauty', '6.é”æˆ', '6.Achievement')});
                    positions.push({x: cx + ltGap, y: cy + ltV, label: getLang('victory', '7.å‹åˆ©', '7.Victory')});
                    positions.push({x: cx - ltGap, y: cy + ltV, label: getLang('glory', '8.æ „å…‰', '8.Glory')});
                    positions.push({x: cx, y: cy + ltV*2, label: getLang('foundation', '9.åŸºç›¤', '9.Foundation')});
                    positions.push({x: cx, y: cy + ltV*3, label: getLang('kingdom', '10.çµæœ', '10.Result')});
                    break;
                case 'horoscope':
                    // ãƒ›ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆ12æšï¼‰- æ™‚è¨ˆå›ã‚Š
                    const horoRadius = isMobile ? 110 : 150;
                    const horoLabels = currentLang === 'ja' 
                        ? ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ']
                        : ['1st', '2nd', '3rd', '4th', '5th', '6th', '7th', '8th', '9th', '10th', '11th', '12th'];
                    for (let i = 0; i < 12; i++) {
                        const angle = (i * 30 - 90) * Math.PI / 180;
                        positions.push({
                            x: cx + Math.cos(angle) * horoRadius,
                            y: cy + Math.sin(angle) * horoRadius,
                            label: horoLabels[i]
                        });
                    }
                    break;
                case 'grand':
                    const gCardW = isMobile ? 55 : 75;
                    const gCardH = isMobile ? 85 : 115;
                    const gStartX = isMobile ? 40 : 50;
                    for (let r = 0; r < 4; r++) {
                        for (let c = 0; c < 9; c++) {
                            positions.push({x: gStartX + c * gCardW, y: 30 + r * gCardH, label: r * 9 + c + 1});
                        }
                    }
                    break;
            }
            return positions;
        }
        
        function shuffleAndDraw() {
            // è£œè¶³ã‚«ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
            supplementCards = [];
            const supArea = document.getElementById('supplement-area');
            const supCards = document.getElementById('supplement-cards');
            if (supArea) supArea.style.display = 'none';
            if (supCards) supCards.innerHTML = '';
            
            const activeCards = getCurrentCards();
            const sigCard = significatorId !== null ? masterCards.find(c => c.id === significatorId) : null;
            const isFixedSig = useSignificator && sigCard && ['one', 'two', 'neutralize', 'circle'].includes(currentSpread);
            const isShuffleSig = useSignificator && sigCard && currentSpread === 'grand';
            
            let shufflePool = activeCards;
            if (isFixedSig) {
                shufflePool = activeCards.filter(c => c.id !== significatorId);
            }
            
            const requiredCount = isFixedSig ? currentSpreadSize - 1 : currentSpreadSize;
            if (shufflePool.length < requiredCount) {
                alert('ã‚«ãƒ¼ãƒ‰ä¸è¶³');
                return;
            }
            
            const inner = document.getElementById('spread-inner');
            inner.innerHTML = '';
            inner.style.minHeight = '350px';
            
            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠ
            const shuffleArea = document.createElement('div');
            shuffleArea.id = 'shuffle-area';
            shuffleArea.style.cssText = 'position:relative;width:100%;height:350px;touch-action:none;';
            inner.appendChild(shuffleArea);
            
            // ã‚«ãƒ¼ãƒ‰ã®å±±ï¼ˆãƒªãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼‰
            const deckX = shuffleArea.offsetWidth / 2 || 150;
            const deckY = 150;
            
            const shuffleCards = [];
            const cardCount = Math.min(12, shufflePool.length);
            
            for (let i = 0; i < cardCount; i++) {
                const card = document.createElement('div');
                card.className = 'shuffle-card';
                card.style.cssText = `
                    position:absolute;
                    width:60px;height:90px;
                    background:linear-gradient(135deg,#667eea,#764ba2);
                    border-radius:6px;
                    box-shadow:0 2px 8px rgba(0,0,0,0.4);
                    left:${deckX - 30}px;
                    top:${deckY - 45 - i * 2}px;
                    z-index:${20 + i};
                    transition:all 0.3s ease;
                    cursor:pointer;
                    display:flex;align-items:center;justify-content:center;
                `;
                if (backCardImage) {
                    card.innerHTML = `<img src="${backCardImage}" style="width:100%;height:100%;object-fit:cover;border-radius:6px;">`;
                } else {
                    card.innerHTML = 'ğŸ”®';
                    card.style.fontSize = '24px';
                }
                card.dataset.collected = 'false';
                shuffleCards.push(card);
                shuffleArea.appendChild(card);
            }
            
            // ãƒªãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            setTimeout(() => {
                shuffleCards.forEach((card, i) => {
                    const delay = i * 50;
                    setTimeout(() => {
                        card.style.transform = 'translateY(-40px) rotateX(-20deg)';
                        setTimeout(() => {
                            card.style.transform = 'translateY(0) rotateX(0)';
                        }, 150);
                    }, delay);
                });
            }, 200);
            
            // æ•£ã‚‰ã°ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            setTimeout(() => {
                shuffleCards.forEach((card, i) => {
                    const angle = (i / cardCount) * Math.PI * 2 + Math.random() * 0.5;
                    const dist = 80 + Math.random() * 60;
                    const x = deckX - 30 + Math.cos(angle) * dist;
                    const y = deckY - 45 + Math.sin(angle) * dist;
                    const rot = (Math.random() - 0.5) * 40;
                    
                    card.style.left = x + 'px';
                    card.style.top = y + 'px';
                    card.style.transform = `rotate(${rot}deg)`;
                    card.style.zIndex = 10 + i;
                });
                
                // èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ
                const hint = document.createElement('div');
                hint.id = 'collect-hint';
                hint.style.cssText = 'text-align:center;color:#64c8ff;font-size:14px;margin-top:10px;position:absolute;bottom:10px;width:100%;';
                hint.innerHTML = currentLang === 'ja' ? 'â†“ ã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—ã—ã¦é›†ã‚ã¦ãã ã•ã„ â†“' : 'â†“ Tap cards to collect â†“';
                shuffleArea.appendChild(hint);
                
                // ã‚¿ãƒƒãƒ—/ã‚¯ãƒªãƒƒã‚¯ã§ã‚«ãƒ¼ãƒ‰ã‚’é›†ã‚ã‚‹
                let collectedCount = 0;
                shuffleCards.forEach((card, i) => {
                    card.onclick = () => {
                        if (card.dataset.collected === 'true') return;
                        card.dataset.collected = 'true';
                        collectedCount++;
                        
                        // ä¸­å¤®ã«æˆ»ã™
                        card.style.left = (deckX - 30) + 'px';
                        card.style.top = (deckY - 45 - collectedCount * 2) + 'px';
                        card.style.transform = 'rotate(0deg)';
                        card.style.zIndex = 30 + collectedCount;
                        
                        // å…¨éƒ¨é›†ã¾ã£ãŸã‚‰ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã
                        if (collectedCount >= cardCount) {
                            setTimeout(() => finishShuffle(), 500);
                        }
                    };
                });
                
                // ã¾ã¨ã‚ã¦é›†ã‚ã‚‹ãƒœã‚¿ãƒ³
                const collectAllBtn = document.createElement('button');
                collectAllBtn.className = 'btn';
                collectAllBtn.style.cssText = 'position:absolute;bottom:40px;left:50%;transform:translateX(-50%);padding:8px 20px;font-size:13px;';
                collectAllBtn.textContent = currentLang === 'ja' ? 'ã¾ã¨ã‚ã¦é›†ã‚ã‚‹' : 'Collect All';
                collectAllBtn.onclick = () => {
                    shuffleCards.forEach((card, i) => {
                        if (card.dataset.collected === 'false') {
                            setTimeout(() => {
                                card.dataset.collected = 'true';
                                collectedCount++;
                                card.style.left = (deckX - 30) + 'px';
                                card.style.top = (deckY - 45 - collectedCount * 2) + 'px';
                                card.style.transform = 'rotate(0deg)';
                                card.style.zIndex = 30 + collectedCount;
                                
                                if (collectedCount >= cardCount) {
                                    setTimeout(() => finishShuffle(), 500);
                                }
                            }, i * 100);
                        }
                    });
                };
                shuffleArea.appendChild(collectAllBtn);
                
            }, 1500);
            
            // ã‚«ãƒ¼ãƒ‰ã‚’å¼•ãå‡¦ç†
            function finishShuffle() {
                const shuffled = [...shufflePool].sort(() => Math.random() - 0.5);
                
                if (isFixedSig) {
                    drawnCards = [];
                    const sigPosition = getSignificatorPosition(currentSpread);
                    let shuffleIndex = 0;
                    
                    for (let i = 0; i < currentSpreadSize; i++) {
                        if (i === sigPosition) {
                            drawnCards.push({...sigCard, isReversed: false, isSignificator: true});
                        } else {
                            drawnCards.push({
                                ...shuffled[shuffleIndex],
                                isReversed: useReversal ? Math.random() < 0.5 : false,
                                isSignificator: false
                            });
                            shuffleIndex++;
                        }
                    }
                } else {
                    drawnCards = shuffled.slice(0, currentSpreadSize).map(card => ({
                        ...card,
                        isReversed: useReversal ? Math.random() < 0.5 : false,
                        isSignificator: isShuffleSig && card.id === significatorId
                    }));
                }
                
                // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
                shuffleArea.style.transition = 'opacity 0.3s';
                shuffleArea.style.opacity = '0';
                
                setTimeout(() => {
                    shuffleArea.remove();
                    inner.style.minHeight = '';
                    setupSpread(currentSpread, currentSpreadSize);
                    
                    drawnCards.forEach((card, i) => {
                        setTimeout(() => drawCard(i, card, false), i * 400);
                    });
                    
                    setTimeout(showResults, drawnCards.length * 400 + 800);
                }, 300);
            }
        }
        
        function getSignificatorPosition(spread) {
            switch(spread) {
                case 'one': return 0; // å®Ÿéš›ã¯è„‡ã«ç½®ããŒã€è¡¨ç¤ºä¸Šã¯0
                case 'two': return 0; // å·¦
                case 'neutralize': return -1; // ç‰¹æ®Šå‡¦ç†ï¼ˆä¸Šéƒ¨ã«é…ç½®ï¼‰
                case 'circle': return 8; // ä¸­å¤®
                default: return 0;
            }
        }
        
        function skipShuffle() {
            // è£œè¶³ã‚«ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
            supplementCards = [];
            const supArea = document.getElementById('supplement-area');
            const supCards = document.getElementById('supplement-cards');
            if (supArea) supArea.style.display = 'none';
            if (supCards) supCards.innerHTML = '';
            
            const activeCards = getCurrentCards();
            const sigCard = significatorId !== null ? masterCards.find(c => c.id === significatorId) : null;
            const isFixedSig = useSignificator && sigCard && ['one', 'two', 'neutralize', 'circle'].includes(currentSpread);
            const isShuffleSig = useSignificator && sigCard && currentSpread === 'grand';
            
            let shufflePool = activeCards;
            if (isFixedSig) {
                shufflePool = activeCards.filter(c => c.id !== significatorId);
            }
            
            const requiredCount = isFixedSig ? currentSpreadSize - 1 : currentSpreadSize;
            if (shufflePool.length < requiredCount) {
                alert('ã‚«ãƒ¼ãƒ‰ä¸è¶³');
                return;
            }
            
            const shuffled = [...shufflePool].sort(() => Math.random() - 0.5);
            
            if (isFixedSig) {
                drawnCards = [];
                const sigPosition = getSignificatorPosition(currentSpread);
                let shuffleIndex = 0;
                
                for (let i = 0; i < currentSpreadSize; i++) {
                    if (i === sigPosition) {
                        drawnCards.push({...sigCard, isReversed: false, isSignificator: true});
                    } else {
                        drawnCards.push({
                            ...shuffled[shuffleIndex],
                            isReversed: useReversal ? Math.random() < 0.5 : false,
                            isSignificator: false
                        });
                        shuffleIndex++;
                    }
                }
            } else {
                drawnCards = shuffled.slice(0, currentSpreadSize).map(card => ({
                    ...card,
                    isReversed: useReversal ? Math.random() < 0.5 : false,
                    isSignificator: isShuffleSig && card.id === significatorId
                }));
            }
            
            drawnCards.forEach((card, i) => drawCard(i, card, true));
            showResults();
        }
        
        function drawCard(index, card, instant) {
            const slot = document.getElementById(`slot-${index}`);
            if (!slot) return;
            
            slot.classList.add('filled');
            if (card.isSignificator) {
                slot.style.boxShadow = '0 0 15px rgba(255,200,100,0.8)';
                slot.style.borderColor = 'rgba(255,200,100,0.8)';
            }
            slot.innerHTML = '';
            
            const cardInner = document.createElement('div');
            cardInner.className = 'card-inner';
            
            const cardBack = document.createElement('div');
            cardBack.className = 'card-face card-back';
            if (backCardImage) {
                cardBack.innerHTML = `<img src="${backCardImage}">`;
            } else {
                cardBack.innerHTML = 'ğŸ”®';
            }
            
            const cardFront = document.createElement('div');
            cardFront.className = 'card-face card-front';
            if (card.isReversed) cardFront.classList.add('reversed');
            
            if (card.imageData) {
                const img = document.createElement('img');
                img.src = card.imageData;
                cardFront.appendChild(img);
            } else {
                cardFront.innerHTML = `<div class="card-text">${card.name}</div>`;
            }
            
            cardFront.onclick = function(e) {
                e.stopPropagation();
                if (card.imageData) {
                    openImageModal(card.imageData, card.isReversed);
                }
            };
            
            cardInner.appendChild(cardBack);
            cardInner.appendChild(cardFront);
            slot.appendChild(cardInner);
            
            if (instant) {
                cardInner.classList.add('flipped');
            } else {
                setTimeout(() => cardInner.classList.add('flipped'), 200);
            }
        }
        
        function openImageModal(src, reversed) {
            const modal = document.getElementById('imageModal');
            const img = document.getElementById('modalImage');
            img.src = src;
            img.className = 'modal-image' + (reversed ? ' reversed' : '');
            modal.classList.add('show');
        }
        
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('show');
        }
        
        // è£œè¶³ã‚«ãƒ¼ãƒ‰ç”¨
        let supplementCards = [];
        const MAX_SUPPLEMENT = 3;
        
        function showResults() {
            const resultDiv = document.getElementById('result-info');
            resultDiv.style.display = 'block';
            
            const resultTitle = currentLang === 'ja' ? 'çµæœ' : 'Results';
            let html = `<h3>${resultTitle}</h3>`;
            
            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰åˆ¥ã®ã‚¬ã‚¤ãƒ‰ï¼ˆå‰Šé™¤ã—ã¦ã‚·ãƒ³ãƒ—ãƒ«ã«ï¼‰
            if (currentSpread === 'grand' && useSignificator) {
                const sigIndex = drawnCards.findIndex(c => c.isSignificator);
                if (sigIndex !== -1) {
                    const sigPosText = currentLang === 'ja' 
                        ? `ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼ä½ç½®: ${sigIndex + 1}ç•ª` 
                        : `Significator Position: #${sigIndex + 1}`;
                    const sigDescText = currentLang === 'ja' 
                        ? 'ã‚°ãƒ©ãƒ³ã‚¿ãƒ–ãƒ­ãƒ¼å†…ã§ã®ã€Œç§ã€ã®ä½ç½®' 
                        : 'Your position in the Grand Tableau';
                    html += `<div style="background:rgba(255,200,100,0.1);padding:12px;border-radius:8px;margin-bottom:15px;font-size:13px;border:1px solid rgba(255,200,100,0.5);">
                        <strong style="color:#ffcc66;">${sigPosText}</strong><br>
                        ${sigDescText}
                    </div>`;
                }
            }
            
            const uprightText = currentLang === 'ja' ? 'æ­£' : 'Up';
            const reversedText = currentLang === 'ja' ? 'é€†' : 'Rev';
            const noDescText = currentLang === 'ja' ? 'èª¬æ˜ãªã—' : 'No description';
            const sigBadgeText = currentLang === 'ja' ? 'ã‚·ã‚°ãƒ‹ãƒ•ã‚£ã‚±ãƒ¼ã‚¿ãƒ¼' : 'Significator';
            
            drawnCards.forEach((card, i) => {
                const pos = card.isReversed ? reversedText : uprightText;
                const positions = getSpreadPositions(currentSpread, currentSpreadSize);
                const label = positions[i] ? positions[i].label : (i + 1);
                const sigStyle = card.isSignificator ? 'border-left:3px solid rgba(255,200,100,0.8);' : '';
                const sigBadge = card.isSignificator ? `<span style="background:rgba(255,200,100,0.3);padding:2px 6px;border-radius:4px;font-size:11px;margin-left:5px;">${sigBadgeText}</span>` : '';
                html += `<div class="card-meaning" style="${sigStyle}"><strong>${label}: ${card.name} (${pos})${sigBadge}</strong><br>${card.description || noDescText}</div>`;
            });
            
            // è£œè¶³ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
            if (supplementCards.length > 0) {
                const supTitle = currentLang === 'ja' ? 'è£œè¶³ã‚«ãƒ¼ãƒ‰' : 'Supplement Cards';
                html += `<h4 style="margin-top:20px;color:#ffcc66;">${supTitle}</h4>`;
                supplementCards.forEach((card, i) => {
                    const pos = card.isReversed ? reversedText : uprightText;
                    const supLabel = currentLang === 'ja' ? `è£œè¶³${i + 1}` : `Sup.${i + 1}`;
                    html += `<div class="card-meaning" style="border-left:3px solid rgba(255,200,100,0.5);"><strong>${supLabel}: ${card.name} (${pos})</strong><br>${card.description || noDescText}</div>`;
                });
            }
            
            // è£œè¶³ã‚«ãƒ¼ãƒ‰ã‚’å¼•ããƒœã‚¿ãƒ³
            const usedIds = [...drawnCards, ...supplementCards].map(c => c.id);
            const remaining = getCurrentCards().filter(c => !usedIds.includes(c.id));
            
            if (supplementCards.length < MAX_SUPPLEMENT && remaining.length > 0) {
                const btnText = currentLang === 'ja' 
                    ? `è£œè¶³ã‚«ãƒ¼ãƒ‰ã‚’å¼•ãï¼ˆæ®‹ã‚Š${MAX_SUPPLEMENT - supplementCards.length}æšã¾ã§ï¼‰`
                    : `Draw Supplement (${MAX_SUPPLEMENT - supplementCards.length} left)`;
                html += `<div style="margin-top:20px;text-align:center;">
                    <button class="btn" onclick="drawSupplement()" style="background:rgba(255,200,100,0.3);border-color:rgba(255,200,100,0.8);">
                        ${btnText}
                    </button>
                </div>`;
            } else if (supplementCards.length >= MAX_SUPPLEMENT) {
                const maxText = currentLang === 'ja' ? 'è£œè¶³ã‚«ãƒ¼ãƒ‰ã¯æœ€å¤§3æšã¾ã§' : 'Maximum 3 supplement cards';
                html += `<div style="margin-top:15px;text-align:center;color:#888;font-size:12px;">${maxText}</div>`;
            }
            
            resultDiv.innerHTML = html;
        }
        
        function drawSupplement() {
            const usedIds = [...drawnCards, ...supplementCards].map(c => c.id);
            const remaining = getCurrentCards().filter(c => !usedIds.includes(c.id));
            
            if (remaining.length === 0) {
                alert(currentLang === 'ja' ? 'å¼•ã‘ã‚‹ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“' : 'No cards available');
                return;
            }
            
            const randomCard = remaining[Math.floor(Math.random() * remaining.length)];
            const newCard = {
                ...randomCard,
                isReversed: useReversal ? Math.random() < 0.5 : false
            };
            supplementCards.push(newCard);
            
            // è£œè¶³ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
            const supArea = document.getElementById('supplement-area');
            const supCards = document.getElementById('supplement-cards');
            supArea.style.display = 'block';
            
            // ã‚«ãƒ¼ãƒ‰è¦ç´ ã‚’è¿½åŠ 
            const cardDiv = document.createElement('div');
            cardDiv.style.cssText = 'width:70px;text-align:center;';
            
            const cardInner = document.createElement('div');
            cardInner.style.cssText = `
                width:70px;height:105px;
                border-radius:6px;
                overflow:hidden;
                border:2px solid rgba(255,200,100,0.8);
                box-shadow:0 0 10px rgba(255,200,100,0.5);
                ${newCard.isReversed ? 'transform:rotate(180deg);' : ''}
            `;
            
            if (newCard.imageData) {
                cardInner.innerHTML = `<img src="${newCard.imageData}" style="width:100%;height:100%;object-fit:cover;">`;
            } else {
                cardInner.innerHTML = `<div style="width:100%;height:100%;background:#2a2a4a;display:flex;align-items:center;justify-content:center;font-size:10px;color:#888;">${newCard.name}</div>`;
            }
            
            cardInner.onclick = () => showCardModal(newCard);
            
            const label = document.createElement('div');
            label.style.cssText = 'font-size:10px;margin-top:5px;color:#ffcc66;';
            const supLabel = currentLang === 'ja' ? 'è£œè¶³' : 'Sup.';
            label.textContent = `${supLabel}${supplementCards.length}`;
            
            cardDiv.appendChild(cardInner);
            cardDiv.appendChild(label);
            supCards.appendChild(cardDiv);
            
            showResults();
        }
        
        function resetReading() {
            drawnCards = [];
            supplementCards = []; // è£œè¶³ã‚«ãƒ¼ãƒ‰ã‚‚ãƒªã‚»ãƒƒãƒˆ
            
            // è£œè¶³ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚‚ã‚¯ãƒªã‚¢
            const supArea = document.getElementById('supplement-area');
            const supCards = document.getElementById('supplement-cards');
            if (supArea) supArea.style.display = 'none';
            if (supCards) supCards.innerHTML = '';
            
            if (currentSpread && currentSpreadSize) {
                setupSpread(currentSpread, currentSpreadSize);
            }
        }
        
        // å„€å¼
        let breathCount = 0;
        
        function startBreathing() {
            breathCount = 0;
            const display = document.getElementById('breathTimer');
            const btn = document.getElementById('breathBtn');
            btn.disabled = true;
            
            const inhaleText = currentLang === 'ja' ? 'å¸ã£ã¦...' : 'Inhale...';
            const exhaleText = currentLang === 'ja' ? 'åã„ã¦...' : 'Exhale...';
            const readyText = currentLang === 'ja' ? 'æº–å‚™å®Œäº† âœ¨' : 'Ready âœ¨';
            const countText = currentLang === 'ja' ? 'å›ç›®' : '';
            
            function cycle() {
                if (breathCount >= 3) {
                    display.textContent = readyText;
                    btn.disabled = false;
                    return;
                }
                breathCount++;
                display.textContent = currentLang === 'ja' 
                    ? `${breathCount}${countText}: ${inhaleText}` 
                    : `#${breathCount}: ${inhaleText}`;
                setTimeout(() => {
                    display.textContent = currentLang === 'ja' 
                        ? `${breathCount}${countText}: ${exhaleText}` 
                        : `#${breathCount}: ${exhaleText}`;
                    setTimeout(cycle, 4000);
                }, 4000);
            }
            cycle();
        }
        
        function setQuestion(text) {
            document.getElementById('questionInput').value = text;
        }
        
        function goToSpread() {
            const q = document.getElementById('questionInput').value;
            if (q) localStorage.setItem('oracleQuestion', q);
            showScreen('spread');
            document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
            document.querySelector('.nav-tabs button:nth-child(3)').classList.add('active');
        }
        
        function saveCrystal() {
            const note = document.getElementById('crystalNote').value.trim();
            if (!note) {
                alert('è¨€è‘‰ã‚’å…¥åŠ›');
                return;
            }
            
            const crystals = JSON.parse(localStorage.getItem('oracleCrystals') || '[]');
            crystals.unshift({date: new Date().toLocaleDateString('ja-JP'), text: note});
            if (crystals.length > 20) crystals.pop();
            
            localStorage.setItem('oracleCrystals', JSON.stringify(crystals));
            document.getElementById('crystalNote').value = '';
            loadCrystals();
            alert('ä¿å­˜ã—ã¾ã—ãŸ âœ¨');
        }
        
        function loadCrystals() {
            const crystals = JSON.parse(localStorage.getItem('oracleCrystals') || '[]');
            const list = document.getElementById('crystalList');
            
            if (crystals.length === 0) {
                const emptyText = currentLang === 'ja' ? 'ã¾ã ã‚ã‚Šã¾ã›ã‚“' : 'None yet';
                list.innerHTML = `<p style="color:#888;font-size:13px;">${emptyText}</p>`;
                return;
            }
            
            list.innerHTML = crystals.map(c => `
                <div class="crystal-item">
                    <div class="crystal-date">${c.date}</div>
                    <div style="font-size:14px;line-height:1.5;">${c.text}</div>
                </div>
            `).join('');
        }
        
        // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‹ã‚‰é–‹å§‹
        function startApp() {
            console.log('startApp called');
            const title = document.getElementById('titleScreen');
            if (title) {
                title.style.transition = 'opacity 0.5s';
                title.style.opacity = '0';
                setTimeout(() => {
                    title.classList.add('hidden');
                }, 500);
            }
        }
        
        // åˆæœŸåŒ–ï¼ˆã‚¨ãƒ©ãƒ¼ãŒã‚ã£ã¦ã‚‚titleScreenã¯å‹•ãã‚ˆã†ã«ï¼‰
        try {
            init();
        } catch(e) {
            console.error('init error:', e);
        }
        try {
            loadCrystals();
        } catch(e) {
            console.error('loadCrystals error:', e);
        }
        
        // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ãƒœã‚¿ãƒ³ï¼ˆDOMContentLoadedå¾Œã«è¨­å®šï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            var btn = document.getElementById('startBtn');
            if (btn) {
                btn.addEventListener('click', startApp);
                btn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    startApp();
                });
            }
        });
        
        // å³æ™‚å®Ÿè¡Œç‰ˆã‚‚å¿µã®ãŸã‚
        (function() {
            var btn = document.getElementById('startBtn');
            if (btn) {
                btn.onclick = startApp;
            }
        })();
        
        // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        function exportData() {
            const data = {
                version: 1,
                exportDate: new Date().toISOString(),
                masterCards: masterCards,
                cardSets: cardSets,
                currentSetName: currentSetName,
                backCardImage: backCardImage,
                significatorId: significatorId,
                crystals: JSON.parse(localStorage.getItem('oracleCrystals') || '[]')
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mayumayan-oracle-backup.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†ï¼\nãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒãƒ›ã«é€ã£ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„');
        }
        
        // ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.masterCards || !data.cardSets) {
                        alert('ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™');
                        return;
                    }
                    
                    if (!confirm('ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ')) {
                        return;
                    }
                    
                    masterCards = data.masterCards;
                    cardSets = data.cardSets;
                    currentSetName = data.currentSetName || 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ';
                    backCardImage = data.backCardImage || '';
                    significatorId = data.significatorId !== undefined ? data.significatorId : null;
                    
                    saveMasterCards();
                    saveSets();
                    localStorage.setItem('oracleCurrentSet', currentSetName);
                    if (backCardImage) {
                        localStorage.setItem('oracleBackImage', backCardImage);
                    }
                    if (significatorId !== null) {
                        localStorage.setItem('oracleSignificator', significatorId);
                    } else {
                        localStorage.removeItem('oracleSignificator');
                    }
                    if (data.crystals) {
                        localStorage.setItem('oracleCrystals', JSON.stringify(data.crystals));
                    }
                    
                    renderCards();
                    updateActiveCount();
                    updateBackPreview();
                    updateStorageInfo();
                    updateSignificatorDisplay();
                    
                    alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼');
                } catch(err) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err.message);
                }
            };
            reader.readAsText(file);
            input.value = '';
        }
    </script>
</body>
</html>
